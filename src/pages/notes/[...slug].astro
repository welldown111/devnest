---
import Layout from "../../layouts/Layout.astro";
import Nav from "../../components/Nav.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allNotes = await getCollection("notes");
  return allNotes
    .filter(n => n.slug.startsWith("publish/"))
    .map(note => ({
      params: { slug: note.slug.replace(/^publish\//, "") },
      props: { note },
    }));
}

const { note } = Astro.props;
const { Content } = await note.render();
---

<Layout title={note.data.title}>
  <Nav slot="nav" />
  <article>
    <header>
      <h1>{note.data.title ?? note.slug.replace(/^publish\//, "")}</h1>
      {note.data.date && <time>{note.data.date.toISOString().slice(0, 10)}</time>}
      {note.data.description && <p class="desc">{note.data.description}</p>}
    </header>
    <div class="prose">
      <Content />
    </div>
  </article>
  <a href="/devnest/notes" class="back">‚Üê Back to notes</a>
</Layout>

<style>
  article { max-width: 680px; }
  header { margin-bottom: 2.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border); }
  h1 { font-size: 2rem; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 0.5rem; }
  time { color: var(--muted); font-size: 0.875rem; }
  .desc { color: var(--muted); margin-top: 0.75rem; }
  .prose { line-height: 1.8; }
  .prose :global(h2) { font-size: 1.3rem; font-weight: 600; margin: 2rem 0 0.75rem; }
  .prose :global(h3) { font-size: 1.1rem; font-weight: 600; margin: 1.5rem 0 0.5rem; }
  .prose :global(p) { margin-bottom: 1rem; }
  .prose :global(ul), .prose :global(ol) { padding-left: 1.5rem; margin-bottom: 1rem; }
  .prose :global(li) { margin-bottom: 0.25rem; }
  .prose :global(code) {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.15em 0.4em;
    font-size: 0.875em;
  }
  .prose :global(pre) {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem;
    overflow-x: auto;
    margin-bottom: 1rem;
  }
  .prose :global(pre code) { background: none; border: none; padding: 0; }
  .prose :global(blockquote) {
    border-left: 3px solid var(--accent);
    padding-left: 1rem;
    color: var(--muted);
    margin: 1rem 0;
  }
  .back {
    display: inline-block;
    margin-top: 3rem;
    color: var(--muted);
    text-decoration: none;
    font-size: 0.9rem;
  }
  .back:hover { color: var(--text); }
</style>
